import{r as a,j as e,u as _,b as y}from"./index-DrSlDiwp.js";import{b as C,f as j,a as N,t as v}from"./toastContent-QZl-Q5Uw.js";const k="_containerProductFather_1qc7a_1",E="_containerProduct_1qc7a_1",A="_productInd_1qc7a_29",I="_labelCategory_1qc7a_71",S="_productInd_label_1qc7a_83",T="_productInd_button_cancel_1qc7a_93",$="_productInd_button_new_1qc7a_123",q="_buttonCancelar_1qc7a_153",F="_buttonAceptar_1qc7a_177",r={containerProductFather:k,containerProduct:E,productInd:A,labelCategory:I,productInd_label:S,productInd_button_cancel:T,productInd_button_new:$,buttonCancelar:q,buttonAceptar:F},M="_window_48kho_2",O="_windowContent_48kho_2",W="_close_48kho_2",w={window:M,windowContent:O,close:W},P=({show:i,handleClose:c,full:p=!1,bigger:m=!1,extraClassName:o,children:l})=>{const s=p?"p-0":"p-6",t=m?"":"md:max-w-2xl",h=a.useRef(null);return window.onclick=function(d){d.target===h.current&&c&&c?.()},a.useEffect(()=>{if(i){if(document.body.style.overflow="hidden",h.current){const d=h.current,b=d.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),x=b[0],n=b[b.length-1],u=f=>{f.key==="Tab"&&(f.shiftKey&&document.activeElement===x?(f.preventDefault(),n.focus()):!f.shiftKey&&document.activeElement===n&&(f.preventDefault(),x.focus()))};return d.addEventListener("keydown",u),()=>{d.removeEventListener("keydown",u)}}}else document.body.style.overflow="auto";return()=>{document.body.style.overflow="auto"}},[i]),a.useEffect(()=>()=>{document.body.style.overflow="auto"},[]),i?e.jsx("div",{ref:h,className:`${w.window} flex`,children:e.jsxs("section",{className:`container ${t} ${w.windowContent} ${s} ${o||""}`,children:[c&&e.jsx("button",{type:"button",className:w.close,onClick:()=>c?.(),children:"x"}),e.jsx("br",{}),l&&l]})}):e.jsx(e.Fragment,{})},z=async(i,c)=>{const o=await N("https://b8v0i9osfj.execute-api.us-east-1.amazonaws.com/Prod/fondos-gestionar","PUT",{},{id_user:i,id_producto:c});if(!(o?.status??!1))throw new Error(o?.msg??"Error al consumir el servicio");return{id_movimiento:o?.obj?.id_movimiento}},D=({productosActivos:i})=>{const c=_(),p=y(),[m,o]=a.useState("ninguno"),[l,s]=a.useState(!1),[t,h]=a.useState(null),[d,b]=a.useState(null),x=a.useCallback(()=>{t&&C(z(c.id_user,t?.id_producto),{render:()=>"Procesando"},{render:({data:n})=>(b(n.id_movimiento),o("aprobada"),"Transacción Aprobada")},{render:({data:n})=>(o("ninguno"),s(!1),n?.message??"Transacción Rechazada")})},[t,c.id_user]);return e.jsxs(a.Fragment,{children:[e.jsx("div",{className:r.containerProductFather,children:e.jsx("div",{className:r.containerProduct,children:i.map(({id_producto:n,nombre:u,valor:f,categoria:g})=>e.jsxs("div",{className:r.productInd,children:[e.jsx("label",{className:r.labelCategory,children:e.jsx("strong",{children:g})}),e.jsx("label",{className:r.productInd_label,children:u}),e.jsx("label",{children:`COP ${j.format(f)}`}),e.jsx("button",{className:r.productInd_button_cancel,onClick:()=>{s(!0),h({id_producto:n,nombre:u,valor:f,categoria:g}),o("resumen")},children:"Anular Suscripción"})]},n))})}),t&&e.jsxs(P,{show:l,handleClose:()=>{s(!1),m=="aprobada"&&p("../")},children:[m=="resumen"&&e.jsxs("div",{className:"grid grid-flow-row auto-rows-max gap-4 place-items-center text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"¿Resumen de la suscripción?"}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Nombre:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:t.nombre})]}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Categoria:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:t.categoria})]}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Valor Actual:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:`COP ${j.format(t.valor)}`})]}),e.jsxs("div",{className:"flex gap-7",children:[e.jsx("button",{className:r.buttonAceptar,onClick:x,children:"Aceptar"}),e.jsx("button",{className:r.buttonCancelar,onClick:()=>s(!1),children:"Cancelar"})]})]}),m=="aprobada"&&e.jsxs("div",{className:"grid grid-flow-row auto-rows-max gap-4 place-items-center text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Transacción Aprobada"}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Valor Transacción:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:`COP ${j.format(t.valor)}`})]}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Número Transacción:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:d})]}),e.jsx("button",{className:r.buttonAceptar,onClick:()=>{s(!1),p("../")},children:"Cerrar"})]})]})]})},R=async(i,c,p)=>{const l=await N("https://b8v0i9osfj.execute-api.us-east-1.amazonaws.com/Prod/fondos-gestionar","POST",{},{id_user:i,id_producto:c,valor:p});if(!(l?.status??!1))throw new Error(l?.msg??"Error al consumir el servicio");return{id_movimiento:l?.obj?.id_movimiento}},V=({productosDisponibles:i})=>{const c=_(),p=y(),[m,o]=a.useState("ninguno"),[l,s]=a.useState(!1),[t,h]=a.useState(null),[d,b]=a.useState(null),x=a.useCallback(()=>{t&&C(R(c.id_user,t?.id_producto,t?.valor),{render:()=>"Procesando"},{render:({data:n})=>(b(n.id_movimiento),o("aprobada"),"Transacción Aprobada")},{render:({data:n})=>(o("ninguno"),s(!1),n?.message??"Transacción Rechazada")})},[t,c.id_user]);return e.jsxs(a.Fragment,{children:[e.jsx("div",{className:r.containerProductFather,children:e.jsx("div",{className:r.containerProduct,children:i.map(({id_producto:n,nombre:u,valor:f,categoria:g})=>e.jsxs("div",{className:r.productInd,children:[e.jsx("label",{className:r.labelCategory,children:e.jsx("strong",{children:g})}),e.jsx("label",{className:r.productInd_label,children:u}),e.jsx("label",{className:r.productInd_label,children:"Monto minimo de vinculación"}),e.jsx("label",{children:`COP ${j.format(f)}`}),e.jsx("button",{className:r.productInd_button_new,onClick:()=>{s(!0),h({id_producto:n,nombre:u,valor:f,categoria:g}),o("resumen")},children:"Suscribirse"})]},n))})}),t&&e.jsxs(P,{show:l,handleClose:()=>{s(!1),m=="aprobada"&&p("../")},children:[m=="resumen"&&e.jsxs("div",{className:"grid grid-flow-row auto-rows-max gap-4 place-items-center text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"¿Esta seguro que quiere cancelar su suscripción?"}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Nombre:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:t.nombre})]}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Categoria:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:t.categoria})]}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Valor Actual:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:`COP ${j.format(t.valor)}`})]}),e.jsxs("div",{className:"flex gap-7",children:[e.jsx("button",{className:r.buttonAceptar,onClick:x,children:"Aceptar"}),e.jsx("button",{className:r.buttonCancelar,onClick:()=>s(!1),children:"Cancelar"})]})]}),m=="aprobada"&&e.jsxs("div",{className:"grid grid-flow-row auto-rows-max gap-4 place-items-center text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Transacción Aprobada"}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Valor Transacción:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:`COP ${j.format(t.valor)}`})]}),e.jsxs("h2",{className:"grid grid-flow-col auto-cols-fr gap-6",children:[e.jsx("strong",{className:"justify-self-end",children:"Número Transacción:"}),e.jsx("p",{className:"justify-self-start whitespace-pre-wrap break-all",children:d})]}),e.jsx("button",{className:r.buttonAceptar,onClick:()=>{s(!1),p("../")},children:"Cerrar"})]})]})]})},U=()=>{const i=_(),[c,p]=a.useState([]),[m,o]=a.useState([]),l=a.useCallback(async s=>{const t="https://b8v0i9osfj.execute-api.us-east-1.amazonaws.com/Prod/fondos-gestionar",h={id_user:i.id_user,tipo:s},d=await N(t,"GET",h,{});if(!(d?.status??!1))throw new Error(d?.msg??"Error al consumir el servicio");return{productos:(d?.obj?.productos??[]).map(u=>({categoria:u?.Categoria,id_producto:Number(u?.id),nombre:u?.Nombre,valor:s=="activos"?u?.valor:u?.Monto_minimo_vinculacion})),page_next:d?.obj?.page_next??!1}},[i]);return a.useEffect(()=>{l("activos").then(s=>{p(s?.productos)}).catch(s=>{v(s?.message,5e3,{toastId:"error_backend_productos_activos"})})},[l]),a.useEffect(()=>{l("disponibles").then(s=>{o(s?.productos)}).catch(s=>{v(s?.message,5e3,{toastId:"error_backend_productos_disponibles"})})},[l]),e.jsxs("div",{children:[e.jsx(D,{productosActivos:c}),e.jsx("br",{}),e.jsx(V,{productosDisponibles:m})]})};export{U as default};
